#Leave this at 1 since beta epsilon is then the morse well depth
variable run_temp equal 1
variable run_steps equal 10000
variable dump_frames equal 100

variable dump_frequency equal ${run_steps}/${dump_frames}
variable thermo_frequency equal ${run_steps}/1000

# read restart file
read_restart equil_*.restart

## Set up Shear

compute		deform_temp all temp/deform
compute		deform_pressure all pressure deform_temp

#run 0

variable sigmaxy equal  -c_deform_pressure[4] #Get the xy stress
variable sigma0 equal 0.0001      # Target stress
variable damp equal 1.0         # Damping parameter
variable dt equal 0.0083        # Timestep of integration
variable Ly equal 5             # Magnitude of the shear

fix 1 all nve
# Every step deform the box by v_deform amount at rate v_rate. 
fix 2 all deform 1 xy variable v_deform v_rate remap x

variable deform equal f_oldrate*${dt}+f_old_deform
variable rate equal f_oldrate+${damp}*(${sigma0}-v_sigmaxy)*${dt}*${Ly}

# Compute the deform and rate variables every step
fix     old_deform all ave/time 1 1 1 v_deform
fix     oldrate all ave/time 1 1 1 v_rate

thermo ${thermo_frequency}
thermo_style custom step temp c_deform_temp press pxy xy pe v_rate

dump 		dumpatom  all atom ${dump_frequency} shear-dump.atom.gz
dump_modify	dumpatom sort id first yes

## Do production

run ${run_steps}


