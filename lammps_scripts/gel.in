# A script to initialise and equilibrate a quiescent Morse gel. Simulation parameters are
# set in the input file specifying the initial configuration. The input file is generated by a Python script.

# Temperature is set to 1 such that beta epsilon is then the morse well depth
variable run_temp equal 1
variable run_steps equal 1000000
variable dump_frames equal 100

variable dump_frequency equal ${run_steps}/${dump_frames}
variable thermo_frequency equal ${run_steps}/1000

units		lj 
atom_style	atomic 
atom_modify	map array 

pair_style	hybrid/overlay morse 1.4 dpd/tstat 1.0 1.0 2.5 34387
# Read particles and interactions from input file
read_data ${file_name}
# Set up the dpd thermostat interactions
pair_coeff * * dpd/tstat 100 1
pair_modify	shift yes
comm_modify vel yes

# Minimise the energy of the particles since the starting configuration is overlapping
minimize 	1e-10 1e-10 3000 3000

# Switch to a triclinic box so we can later deform it
change_box all triclinic

# Set initial random particle velocities at T = 1.
velocity all create 1 1234

# We assume box is cubic in the input file
variable L equal xhi-xlo
print "Box size $L"

timestep 0.001

# Set up variables for the thermodynamic output
variable varstep equal step
variable vartemp equal temp
variable varpress equal press
variable varetotal equal etotal
compute  msd all msd

# Periodically output particle position data in the lammps atom format
dump 		dumpatom  all atom ${dump_frequency} gel_equil.atom.gz
dump_modify	dumpatom sort id first yes

# Periodically output the mean square displacement
fix	msd all ave/time 1 1 ${thermo_frequency} c_msd[4] file msd.txt

# Perioically print out thermodynamic variables
fix thermo_print all print ${thermo_frequency} "${varstep} ${vartemp} ${varpress} ${varetotal}" file gel_equil_${run_steps}.thermo screen no
thermo ${thermo_frequency}
thermo_style custom step temp press pe

# Do gel equilibration in nvt
fix equilibrate all nvt temp ${run_temp} ${run_temp} 1
run ${run_steps}
unfix equilibrate

# Write out a restart file to input to a different script
write_restart equil_${run_steps}.restart
